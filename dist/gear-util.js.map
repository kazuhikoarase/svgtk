{"version":3,"file":"gear-util.js","sources":["../src/gear-util.ts"],"sourcesContent":["//\n// gear-util\n//\n// Copyright (c) 2025 Kazuhiko Arase\n//\n// URL: http://www.d-project.com/\n//\n// Licensed under the MIT license:\n//  http://www.opensource.org/licenses/mit-license.php\n//\n\nimport { mat4 } from './mat4';\nimport svgtk from './svgtk';\n\nconst extend = svgtk.core.extend;\nconst getQuadPoints = svgtk.math.getQuadPoints;\nconst $pb = svgtk.util.pathBuilder;\n\n// t = sqrt(rr^2 / r^2 - 1)\nconst get_t = function(r : number, rr : number) {\n  return Math.sqrt( (rr * rr) / (r * r) - 1);\n};\n\nconst get_fn = function(r : number, t0 : number) {\n  return function(t : number) {\n    return [\n      r * Math.cos(t + t0) + r * t * Math.sin(t + t0),\n      r * Math.sin(t + t0) - r * t * Math.cos(t + t0)\n    ];\n  };\n};\n\nconst quadParams = { n : 3, dt : 0.05 };\n\nexport type GearOpts = {\n  m : number;\n  z : number;\n  a : number;\n}\n\nexport type PieOpts = {\n  r1 : number;\n  r2 : number;\n  r3 : number;\n  r4 : number;\n  w : number;\n  a : number;\n  offsetAngle : number;\n}\n\nexport const createGear = function(opts : GearOpts) {\n\n  opts = extend({ m : 20, z : 20, a : Math.PI * 20 / 180 }, opts);\n\n  const m = opts.m;\n  const z = opts.z;\n\n  const d = z * m;\n  const d1 = d - 2.5 * m;\n  const d2 = d + 2 * m;\n  const db = d * Math.cos(opts.a);\n\n  let r = db / 2;\n  r = Math.max(r, d1 / 2); // fix - r\n  const tMin = Math.PI * 2 * 0;\n  const tMax = get_t(r, d2 / 2);\n\n  const p = get_fn(r, 0)(get_t(r, d / 2) );\n  const t0 = -Math.atan(p[1] / p[0]);\n\n  const pb = $pb();\n\n  let i, qPts, tOffset = 0;\n\n  for (let m = 0; m < z; m += 1) {\n\n    qPts = getQuadPoints({ fn : get_fn(r, t0 + tOffset),\n      min : tMin, max : tMax, n : quadParams.n, dt : quadParams.dt });\n    for (i = 0; i < qPts.length; i += 1) {\n      if (i == 0) {\n        if (m == 0) {\n          pb.moveTo(qPts[i][0], qPts[i][1]);\n        }\n      } else {\n        pb.quadTo(qPts[i][0], qPts[i][1], qPts[i][2], qPts[i][3]);\n      }\n    }\n    tOffset += Math.PI / z;\n\n    qPts = getQuadPoints({ fn : get_fn(r, -t0 + tOffset),\n      min : -tMax, max : tMin, n : quadParams.n, dt : quadParams.dt });\n    for (i = 0; i < qPts.length; i += 1) {\n      if (i == 0) {\n        pb.lineTo(qPts[i][0], qPts[i][1]);\n      } else {\n        pb.quadTo(qPts[i][0], qPts[i][1], qPts[i][2], qPts[i][3]);\n      }\n    }\n    tOffset += Math.PI / z;\n\n    !function() : any {\n      let t1;\n      const r1 = d1 / 2;\n      const pts1 = [];\n      t1 = Math.PI / z * (m * 2 + 1) - t0;\n      pts1.push([r1 * Math.cos(t1), r1 * Math.sin(t1)]);\n      t1 = Math.PI / z * (m * 2 + 1.5);\n      pts1.push([r1 * Math.cos(t1), r1 * Math.sin(t1)]);\n      t1 = Math.PI / z * (m * 2 + 2) + t0;\n      pts1.push([r1 * Math.cos(t1), r1 * Math.sin(t1)]);\n      t1 = Math.PI / z * (m * 2 + 2) + t0;\n      pts1.push([r * Math.cos(t1), r * Math.sin(t1)]);\n      pb.quadTo(pts1[0][0], pts1[0][1], pts1[1][0], pts1[1][1]);\n      pb.quadTo(pts1[2][0], pts1[2][1], pts1[3][0], pts1[3][1]);\n    }();\n  }\n\n  pb.close();\n\n  return {\n    m : m, z : z, d : d, d1 : d1, d2 : d2, r : r,\n    tMin : tMin, tMax : tMax, t0 : t0,\n    path : pb.build()\n  };\n};\n\nexport const createInnerGear = function(opts : GearOpts) {\n\n  opts = extend({ m : 20, z : 20, a : Math.PI * 20 / 180 }, opts);\n\n  const m = opts.m;\n  const z = opts.z;\n\n  const d = z * m;\n  const d1 = d + 2.5 * m;\n  const d2 = d - 2 * m;\n  const db = d * Math.cos(opts.a);\n\n  let r = db / 2;\n  r = Math.max(r, d2 / 2); // fix - r\n  const tMin = Math.PI * 2 * 0;\n  const tMax = get_t(r, d1 / 2);\n\n  const p = get_fn(r, 0)(get_t(r, d / 2) );\n  const t0 = -Math.atan(p[1] / p[0]);\n\n  const pb = $pb();\n\n  let i, qPts, tOffset = 0;\n\n  for (let m = 0; m < z; m += 1) {\n\n    qPts = getQuadPoints({ fn : get_fn(r, -t0 + tOffset),\n      min : -tMax, max : tMin, n : quadParams.n, dt : quadParams.dt });\n    for (i = 0; i < qPts.length; i += 1) {\n      if (i == 0) {\n        if (m == 0) {\n          pb.moveTo(qPts[i][0], qPts[i][1]);\n        }\n      } else {\n        pb.quadTo(qPts[i][0], qPts[i][1], qPts[i][2], qPts[i][3]);\n      }\n    }\n    tOffset += Math.PI / z;\n\n    qPts = getQuadPoints({ fn : get_fn(r, t0 + tOffset),\n      min : tMin, max : tMax, n : quadParams.n, dt : quadParams.dt });\n    for (i = 0; i < qPts.length; i += 1) {\n      if (i == 0) {\n        pb.lineTo(qPts[i][0], qPts[i][1]);\n      } else {\n        pb.quadTo(qPts[i][0], qPts[i][1], qPts[i][2], qPts[i][3]);\n      }\n    }\n    tOffset += Math.PI / z;\n\n    !function() : any {\n      let t1;\n      const r1 = d1 / 2;\n      t1 = Math.PI / z * (m * 2 + 1.5) - t0;\n      pb.lineTo(r1 * Math.cos(t1), r1 * Math.sin(t1));\n    }();\n  }\n\n  pb.close();\n\n  return {\n    m : m, z : z, d : d, d1 : d1, d2 : d2, r : r,\n    tMin : tMin, tMax : tMax, t0 : t0,\n    path : pb.build()\n  };\n};\n\nexport const createPie = function(opts : PieOpts) {\n\n  opts = extend({\n    r1 : 100, r2 : 200, r3 : 10, r4 : 10,\n    w : 10, a : Math.PI / 2, offsetAngle : 0\n  }, opts);\n\n  const arcs : { order : number, cx : number, cy : number, r : number, t0 : number, t1 : number }[] = [];\n\n  !function() : any {\n    const a = Math.asin( (opts.w / 2 + opts.r3) / (opts.r1 + opts.r3) );\n    const x = opts.r1 * Math.cos(a);\n    const y = opts.r1 * Math.sin(a);\n    const t = Math.atan2(y, x);\n    arcs.push({ order : 0, cx : 0, cy : 0,\n      r : opts.r1, t0 : opts.a - t, t1 : t });\n  }();\n\n  !function() : any {\n    let dt;\n    !function(a) : any {\n      const x = opts.r1 * Math.cos(a);\n      const y = opts.r1 * Math.sin(a);\n      const cx = (opts.r1 + opts.r3) * Math.cos(a);\n      const cy = (opts.r1 + opts.r3) * Math.sin(a);\n      const t0 = Math.atan2(y - cy, x - cx);\n      const t1 = Math.atan2(opts.w / 2 - cy, 0);\n      arcs.push({ order : 1, cx : cx, cy : cy,\n        r : opts.r3, t0 : t0, t1 : t1 });\n      dt = t1 - t0;\n    }(Math.asin( (opts.w / 2 + opts.r3) / (opts.r1 + opts.r3) ) );\n    !function(a) : any {\n      const x = opts.r1 * Math.cos(a);\n      const y = opts.r1 * Math.sin(a);\n      const cx = (opts.r1 + opts.r3) * Math.cos(a);\n      const cy = (opts.r1 + opts.r3) * Math.sin(a);\n      const t0 = Math.atan2(y - cy, x - cx);\n      const t1 = t0 - dt;\n      arcs.push({ order : 5, cx : cx, cy : cy,\n        r : opts.r3, t0 : t1, t1 : t0 });\n    }(opts.a - Math.asin( (opts.w / 2 + opts.r3) / (opts.r1 + opts.r3) ) );\n  }();\n\n  !function() : any {\n    const a = Math.asin( (opts.w / 2 + opts.r4) / (opts.r2 - opts.r4) );\n    const x = opts.r2 * Math.cos(a);\n    const y = opts.r2 * Math.sin(a);\n    const t = Math.atan2(y, x);\n    arcs.push({ order : 3, cx : 0, cy : 0,\n      r : opts.r2, t0 : t, t1 : opts.a - t });\n  }();\n\n  !function() : any {\n    let dt;\n    !function(a) : any {\n      const x = opts.r2 * Math.cos(a);\n      const y = opts.r2 * Math.sin(a);\n      const cx = (opts.r2 - opts.r4) * Math.cos(a);\n      const cy = (opts.r2 - opts.r4) * Math.sin(a);\n      const t0 = Math.atan2(opts.w / 2 - cy, 0);\n      const t1 = Math.atan2(y - cy, x - cx);\n      arcs.push({ order : 2, cx : cx, cy : cy,\n        r : opts.r4, t0 : t0, t1 : t1 });\n      dt = t1 - t0;\n    }(Math.asin( (opts.w / 2 + opts.r4) / (opts.r2 - opts.r4) ) );\n    !function(a) : any {\n      const x = opts.r2 * Math.cos(a);\n      const y = opts.r2 * Math.sin(a);\n      const cx = (opts.r2 - opts.r4) * Math.cos(a);\n      const cy = (opts.r2 - opts.r4) * Math.sin(a);\n      const t1 = Math.atan2(y - cy, x - cx);\n      const t0 = t1 + dt;\n      arcs.push({ order : 4, cx : cx, cy : cy,\n        r : opts.r4, t0 : t1, t1 : t0 });\n    }(opts.a - Math.asin( (opts.w / 2 + opts.r4) / (opts.r2 - opts.r4) ) );\n  }();\n\n  arcs.sort(function(a1, a2) {\n    return a1.order < a2.order ? -1 : 1;\n  });\n\n  const mat = mat4().rotateZ(opts.offsetAngle);\n\n  const pb = $pb();\n  arcs.forEach(function(arc) {\n    const fn =function(t : number) {\n      return [\n        arc.r * Math.cos(t) + arc.cx,\n        arc.r * Math.sin(t) + arc.cy\n      ];\n    };\n    const d = getQuadPoints({ fn : fn,\n      min : arc.t0, max : arc.t1, n : 4, dt : 0.05 });\n    for (let i = 0; i < d.length; i += 1) {\n      d[i] = mat.transform([d[i][0], d[i][1]]).\n        concat(mat.transform([d[i][2], d[i][3]]) );\n      if (i == 0) {\n        if (arc.order == 0) {\n          pb.moveTo(d[i][0], d[i][1]);\n        } else if (arc.order == 2) {\n          pb.lineTo(d[i][0], d[i][1]);\n        } else if (arc.order == 5) {\n          pb.lineTo(d[i][0], d[i][1]);\n        }\n      } else {\n        pb.quadTo(d[i][0], d[i][1], d[i][2], d[i][3]);\n      }\n    }\n  });\n  pb.close();\n\n  return { path : pb.build() };\n};\n"],"names":["extend","svgtk","getQuadPoints","$pb","get_t","r","rr","get_fn","t0","t","quadParams","createGear","opts","m","z","d","d1","d2","tMin","tMax","p","pb","i","qPts","tOffset","t1","r1","pts1","createInnerGear","createPie","arcs","a","x","y","dt","cx","cy","a1","a2","mat","mat4","arc"],"mappings":"qIAcMA,EAASC,EAAM,KAAK,OACpBC,EAAgBD,EAAM,KAAK,cAC3BE,EAAMF,EAAM,KAAK,YAGjBG,EAAQ,SAASC,EAAYC,EAAa,CAC9C,OAAO,KAAK,KAAOA,EAAKA,GAAOD,EAAIA,GAAK,CAAC,CAC3C,EAEME,EAAS,SAASF,EAAYG,EAAa,CAC/C,OAAO,SAASC,EAAY,CAC1B,MAAO,CACLJ,EAAI,KAAK,IAAII,EAAID,CAAE,EAAIH,EAAII,EAAI,KAAK,IAAIA,EAAID,CAAE,EAC9CH,EAAI,KAAK,IAAII,EAAID,CAAE,EAAIH,EAAII,EAAI,KAAK,IAAIA,EAAID,CAAE,CAAA,CAChD,CAEJ,EAEME,EAAa,CAAE,EAAI,EAAG,GAAK,GAAA,EAkBpBC,EAAa,SAASC,EAAiB,CAElDA,EAAOZ,EAAO,CAAE,EAAI,GAAI,EAAI,GAAI,EAAI,KAAK,GAAK,GAAK,GAAA,EAAOY,CAAI,EAE9D,MAAMC,EAAID,EAAK,EACTE,EAAIF,EAAK,EAETG,EAAID,EAAID,EACRG,EAAKD,EAAI,IAAMF,EACfI,EAAKF,EAAI,EAAIF,EAGnB,IAAIR,EAFOU,EAAI,KAAK,IAAIH,EAAK,CAAC,EAEjB,EACbP,EAAI,KAAK,IAAIA,EAAGW,EAAK,CAAC,EACtB,MAAME,EAAO,KAAK,GAAK,EAAI,EACrBC,EAAOf,EAAMC,EAAGY,EAAK,CAAC,EAEtBG,EAAIb,EAAOF,EAAG,CAAC,EAAED,EAAMC,EAAGU,EAAI,CAAC,CAAE,EACjCP,EAAK,CAAC,KAAK,KAAKY,EAAE,CAAC,EAAIA,EAAE,CAAC,CAAC,EAE3BC,EAAKlB,EAAA,EAEX,IAAImB,EAAGC,EAAMC,EAAU,EAEvB,QAASX,EAAI,EAAGA,EAAIC,EAAGD,GAAK,EAAG,CAI7B,IAFAU,EAAOrB,EAAc,CAAE,GAAKK,EAAOF,EAAGG,EAAKgB,CAAO,EAChD,IAAMN,EAAM,IAAMC,EAAM,EAAIT,EAAW,EAAG,GAAKA,EAAW,EAAA,CAAI,EAC3DY,EAAI,EAAGA,EAAIC,EAAK,OAAQD,GAAK,EAC5BA,GAAK,EACHT,GAAK,GACPQ,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAGlCD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAO5D,IAJAE,GAAW,KAAK,GAAKV,EAErBS,EAAOrB,EAAc,CAAE,GAAKK,EAAOF,EAAG,CAACG,EAAKgB,CAAO,EACjD,IAAM,CAACL,EAAM,IAAMD,EAAM,EAAIR,EAAW,EAAG,GAAKA,EAAW,EAAA,CAAI,EAC5DY,EAAI,EAAGA,EAAIC,EAAK,OAAQD,GAAK,EAC5BA,GAAK,EACPD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAEhCD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAG5DE,GAAW,KAAK,GAAKV,EAEpB,UAAiB,CAChB,IAAIW,EACJ,MAAMC,EAAKV,EAAK,EACVW,EAAO,CAAA,EACbF,EAAK,KAAK,GAAKX,GAAKD,EAAI,EAAI,GAAKL,EACjCmB,EAAK,KAAK,CAACD,EAAK,KAAK,IAAID,CAAE,EAAGC,EAAK,KAAK,IAAID,CAAE,CAAC,CAAC,EAChDA,EAAK,KAAK,GAAKX,GAAKD,EAAI,EAAI,KAC5Bc,EAAK,KAAK,CAACD,EAAK,KAAK,IAAID,CAAE,EAAGC,EAAK,KAAK,IAAID,CAAE,CAAC,CAAC,EAChDA,EAAK,KAAK,GAAKX,GAAKD,EAAI,EAAI,GAAKL,EACjCmB,EAAK,KAAK,CAACD,EAAK,KAAK,IAAID,CAAE,EAAGC,EAAK,KAAK,IAAID,CAAE,CAAC,CAAC,EAChDA,EAAK,KAAK,GAAKX,GAAKD,EAAI,EAAI,GAAKL,EACjCmB,EAAK,KAAK,CAACtB,EAAI,KAAK,IAAIoB,CAAE,EAAGpB,EAAI,KAAK,IAAIoB,CAAE,CAAC,CAAC,EAC9CJ,EAAG,OAAOM,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,CAAC,EACxDN,EAAG,OAAOM,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,EAAGA,EAAK,CAAC,EAAE,CAAC,CAAC,CAAA,EAC1D,CAAE,CAGJ,OAAAN,EAAG,MAAA,EAEI,CACL,EAAAR,EAAO,EAAAC,EAAO,EAAAC,EAAO,GAAAC,EAAS,GAAAC,EAAS,EAAAZ,EACvC,KAAAa,EAAa,KAAAC,EAAa,GAAAX,EAC1B,KAAOa,EAAG,MAAA,CAAM,CAEpB,EAEaO,EAAkB,SAAShB,EAAiB,CAEvDA,EAAOZ,EAAO,CAAE,EAAI,GAAI,EAAI,GAAI,EAAI,KAAK,GAAK,GAAK,GAAA,EAAOY,CAAI,EAE9D,MAAMC,EAAID,EAAK,EACTE,EAAIF,EAAK,EAETG,EAAID,EAAID,EACRG,EAAKD,EAAI,IAAMF,EACfI,EAAKF,EAAI,EAAIF,EAGnB,IAAIR,EAFOU,EAAI,KAAK,IAAIH,EAAK,CAAC,EAEjB,EACbP,EAAI,KAAK,IAAIA,EAAGY,EAAK,CAAC,EACtB,MAAMC,EAAO,KAAK,GAAK,EAAI,EACrBC,EAAOf,EAAMC,EAAGW,EAAK,CAAC,EAEtBI,EAAIb,EAAOF,EAAG,CAAC,EAAED,EAAMC,EAAGU,EAAI,CAAC,CAAE,EACjCP,EAAK,CAAC,KAAK,KAAKY,EAAE,CAAC,EAAIA,EAAE,CAAC,CAAC,EAE3BC,EAAKlB,EAAA,EAEX,IAAImB,EAAGC,EAAMC,EAAU,EAEvB,QAASX,EAAI,EAAGA,EAAIC,EAAGD,GAAK,EAAG,CAI7B,IAFAU,EAAOrB,EAAc,CAAE,GAAKK,EAAOF,EAAG,CAACG,EAAKgB,CAAO,EACjD,IAAM,CAACL,EAAM,IAAMD,EAAM,EAAIR,EAAW,EAAG,GAAKA,EAAW,EAAA,CAAI,EAC5DY,EAAI,EAAGA,EAAIC,EAAK,OAAQD,GAAK,EAC5BA,GAAK,EACHT,GAAK,GACPQ,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAGlCD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAO5D,IAJAE,GAAW,KAAK,GAAKV,EAErBS,EAAOrB,EAAc,CAAE,GAAKK,EAAOF,EAAGG,EAAKgB,CAAO,EAChD,IAAMN,EAAM,IAAMC,EAAM,EAAIT,EAAW,EAAG,GAAKA,EAAW,EAAA,CAAI,EAC3DY,EAAI,EAAGA,EAAIC,EAAK,OAAQD,GAAK,EAC5BA,GAAK,EACPD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAEhCD,EAAG,OAAOE,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,EAAGC,EAAKD,CAAC,EAAE,CAAC,CAAC,EAG5DE,GAAW,KAAK,GAAKV,EAEpB,UAAiB,CAChB,IAAIW,EACJ,MAAMC,EAAKV,EAAK,EAChBS,EAAK,KAAK,GAAKX,GAAKD,EAAI,EAAI,KAAOL,EACnCa,EAAG,OAAOK,EAAK,KAAK,IAAID,CAAE,EAAGC,EAAK,KAAK,IAAID,CAAE,CAAC,CAAA,EAChD,CAAE,CAGJ,OAAAJ,EAAG,MAAA,EAEI,CACL,EAAAR,EAAO,EAAAC,EAAO,EAAAC,EAAO,GAAAC,EAAS,GAAAC,EAAS,EAAAZ,EACvC,KAAAa,EAAa,KAAAC,EAAa,GAAAX,EAC1B,KAAOa,EAAG,MAAA,CAAM,CAEpB,EAEaQ,EAAY,SAASjB,EAAgB,CAEhDA,EAAOZ,EAAO,CACZ,GAAK,IAAK,GAAK,IAAK,GAAK,GAAI,GAAK,GAClC,EAAI,GAAI,EAAI,KAAK,GAAK,EAAG,YAAc,CAAA,EACtCY,CAAI,EAEP,MAAMkB,EAA8F,CAAA,GAEnG,UAAiB,CAChB,MAAMC,EAAI,KAAK,MAAOnB,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,EAC5DoB,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxB,EAAI,KAAK,MAAME,EAAGD,CAAC,EACzBF,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAK,EAAG,GAAK,EAClC,EAAIlB,EAAK,GAAI,GAAKA,EAAK,EAAI,EAAG,GAAK,CAAA,CAAG,CAAA,GAC1C,EAEC,UAAiB,CAChB,IAAIsB,GACH,SAASH,EAAS,CACjB,MAAMC,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBI,GAAMvB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCK,GAAMxB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCvB,EAAK,KAAK,MAAMyB,EAAIG,EAAIJ,EAAIG,CAAE,EAC9BV,EAAK,KAAK,MAAMb,EAAK,EAAI,EAAIwB,EAAI,CAAC,EACxCN,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAAK,EAAS,GAAAC,EAC9B,EAAIxB,EAAK,GAAI,GAAAJ,EAAS,GAAAiB,CAAA,CAAS,EACjCS,EAAKT,EAAKjB,CAAA,GACV,KAAK,MAAOI,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,CAAE,EAC3D,SAASmB,EAAS,CACjB,MAAMC,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBI,GAAMvB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCK,GAAMxB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCvB,EAAK,KAAK,MAAMyB,EAAIG,EAAIJ,EAAIG,CAAE,EAC9BV,EAAKjB,EAAK0B,EAChBJ,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAAK,EAAS,GAAAC,EAC9B,EAAIxB,EAAK,GAAI,GAAKa,EAAI,GAAKjB,CAAA,CAAI,CAAA,EACjCI,EAAK,EAAI,KAAK,MAAOA,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,CAAE,CAAA,EACvE,EAEC,UAAiB,CAChB,MAAMmB,EAAI,KAAK,MAAOnB,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,EAC5DoB,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxB,EAAI,KAAK,MAAME,EAAGD,CAAC,EACzBF,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAK,EAAG,GAAK,EAClC,EAAIlB,EAAK,GAAI,GAAK,EAAG,GAAKA,EAAK,EAAI,CAAA,CAAG,CAAA,EAC1C,EAEC,UAAiB,CAChB,IAAIsB,GACH,SAASH,EAAS,CACjB,MAAMC,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBI,GAAMvB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCK,GAAMxB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCvB,EAAK,KAAK,MAAMI,EAAK,EAAI,EAAIwB,EAAI,CAAC,EAClCX,EAAK,KAAK,MAAMQ,EAAIG,EAAIJ,EAAIG,CAAE,EACpCL,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAAK,EAAS,GAAAC,EAC9B,EAAIxB,EAAK,GAAI,GAAAJ,EAAS,GAAAiB,CAAA,CAAS,EACjCS,EAAKT,EAAKjB,CAAA,GACV,KAAK,MAAOI,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,CAAE,EAC3D,SAASmB,EAAS,CACjB,MAAMC,EAAIpB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBE,EAAIrB,EAAK,GAAK,KAAK,IAAImB,CAAC,EACxBI,GAAMvB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCK,GAAMxB,EAAK,GAAKA,EAAK,IAAM,KAAK,IAAImB,CAAC,EACrCN,EAAK,KAAK,MAAMQ,EAAIG,EAAIJ,EAAIG,CAAE,EAC9B3B,EAAKiB,EAAKS,EAChBJ,EAAK,KAAK,CAAE,MAAQ,EAAG,GAAAK,EAAS,GAAAC,EAC9B,EAAIxB,EAAK,GAAI,GAAKa,EAAI,GAAKjB,CAAA,CAAI,CAAA,EACjCI,EAAK,EAAI,KAAK,MAAOA,EAAK,EAAI,EAAIA,EAAK,KAAOA,EAAK,GAAKA,EAAK,GAAI,CAAE,CAAA,EACvE,EAEAkB,EAAK,KAAK,SAASO,EAAIC,EAAI,CACzB,OAAOD,EAAG,MAAQC,EAAG,MAAQ,GAAK,CAAA,CACnC,EAED,MAAMC,EAAMC,EAAAA,KAAA,EAAO,QAAQ5B,EAAK,WAAW,EAErCS,EAAKlB,EAAA,EACX,OAAA2B,EAAK,QAAQ,SAASW,EAAK,CAOzB,MAAM1B,EAAIb,EAAc,CAAE,GANhB,SAAS,EAAY,CAC7B,MAAO,CACLuC,EAAI,EAAI,KAAK,IAAI,CAAC,EAAIA,EAAI,GAC1BA,EAAI,EAAI,KAAK,IAAI,CAAC,EAAIA,EAAI,EAAA,CAC5B,EAGA,IAAMA,EAAI,GAAI,IAAMA,EAAI,GAAI,EAAI,EAAG,GAAK,GAAA,CAAM,EAChD,QAASnB,EAAI,EAAGA,EAAIP,EAAE,OAAQO,GAAK,EACjCP,EAAEO,CAAC,EAAIiB,EAAI,UAAU,CAACxB,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,CAAC,CAAC,EACrC,OAAOiB,EAAI,UAAU,CAACxB,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAE,EACvCA,GAAK,EACHmB,EAAI,OAAS,EACfpB,EAAG,OAAON,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,CAAC,GACjBmB,EAAI,OAAS,GAEbA,EAAI,OAAS,IACtBpB,EAAG,OAAON,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,CAAC,EAG5BD,EAAG,OAAON,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,EAAGP,EAAEO,CAAC,EAAE,CAAC,CAAC,CAEhD,CACD,EACDD,EAAG,MAAA,EAEI,CAAE,KAAOA,EAAG,OAAM,CAC3B"}